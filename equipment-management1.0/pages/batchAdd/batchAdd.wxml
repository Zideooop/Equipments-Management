<view class="container">
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="iconfont icon-back"></text>
    </view>
    <text class="title">批量录入器材</text>
  </view>

  <view class="guide">
    <text class="guide-title">录入格式说明：</text>
    <text class="guide-content">每行输入一个器材信息，使用英文逗号分隔字段</text>
    <text class="guide-example">格式：器材编号,器材名称,器材类型,存放位置,描述</text>
    <text class="guide-example">示例：CAM001,索尼A7M3,拍摄器材,器材室A区,全画幅微单</text>
  </view>

  <view class="form-container">
    <textarea 
      class="batch-input" 
      placeholder="请按格式输入器材信息，每行一个"
      bindinput="onTextInput"
      value="{{inputText}}"
      auto-height
    ></textarea>

    <button class="preview-btn" bindtap="previewData">预览数据</button>
  </view>

  <!-- 预览区域 -->
  <view class="preview-area" wx:if="{{showPreview}}">
    <text class="preview-title">数据预览 (共 {{previewList.length}} 条)</text>
    <view class="preview-table">
      <view class="table-header">
        <view class="table-cell">编号</view>
        <view class="table-cell">名称</view>
        <view class="table-cell">类型</view>
        <view class="table-cell">操作</view>
      </view>
      <block wx:for="{{previewList}}" wx:key="index">
        <view class="table-row {{item.invalid ? 'invalid' : ''}}">
          <view class="table-cell">{{item.data.id || '缺失'}}</view>
          <view class="table-cell">{{item.data.name || '缺失'}}</view>
          <view class="table-cell">{{item.data.type || '缺失'}}</view>
          <view class="table-cell">
            <text wx:if="{{item.invalid}}" class="error-tip">格式错误</text>
            <button wx:else size="mini" bindtap="removeItem" data-index="{{index}}">删除</button>
          </view>
        </view>
      </block>
    </view>

    <view class="batch-actions">
      <button class="cancel-btn" bindtap="cancelPreview">重新编辑</button>
      <button class="submit-btn" bindtap="submitBatch" wx:if="{{validCount > 0}}">
        确认导入 (有效{{validCount}}条)
      </button>
    </view>
  </view>
</view>